<html>

<head>
    <link rel="stylesheet" href="./css/main_page.css" type="text/css">
    <link rel="stylesheet" href="flexslider.css" type="text/css">
    <link rel="stylesheet" href="css/rest.css" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script src="jquery.flexslider.js"></script>
    <script type="text/javaseriot" charset="utf-8">
        $(window).load(function(){
            $('.flexslider').flexslider({)
        });
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <title>allen pages</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Shadows+Into+Light&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>
</head>

<body style="background-color: rgb(237, 231, 231);">
    <nav  class="navbar navbar-expand-lg navbar-light bg-light" style="background-color: #b8bbbf;">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Navbar</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="./dashboard.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./traceroute.html">Traceroute</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Webloading</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <section id="main">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-9" style="height: 900px; ">
                    <div id="table">
                        <div class="container-fluid">
                            <table id="example" class="display" style="width:100%; background-color: rgb(224, 221, 221);"  >
                                <thead>
                                    <tr>
                                        <th rowspan="1" ></th>
                                        <th rowspan="2" style="border: 1px solid black; text-align: center;"><h1>地點</h1></th>
                                        <th colspan="2" style="text-align: center; border: 1px solid black;">Traceroute</th>
                                        <th colspan="2" style="text-align: center; border: 1px solid black;">Webloading</th>
                                        <th colspan="2" style="text-align: center; border: 1px solid black;">Speedtest</th>
                                        
                                        
                                    </tr>
                                    <tr>
                                        <th ></th>
                                        <th style="border: 1px solid black;white-space: normal;text-align: center;">超過歷史平均(%)</th>
                                        <th style="border: 1px solid black;white-space: normal;text-align: center;">Count</th>
                                        <th style="border: 1px solid black;text-align: center;">超過歷史平均(%)</th>
                                        <th style="border: 1px solid black;text-align: center;">Count</th>
                                        <th style="border: 1px solid black;text-align: center;">upload</th>
                                        <th style="border: 1px solid black;text-align: center;">download</th>
                                        
                                    </tr>
                                </thead>
                                <tbody style="text-align:start;" id="myTable" >
                                    
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-md-3" style="margin-top: 120px;">
                        <div class="col">
                            <div class="row-md-3" style="height: 175px;">
                                <div id="dcard" style="background-color:bisque; ">
                                    
                                </div>
                            </div>
                            <div class="row-md-3" style="height: 175px;">
                                <div id="internet_center" style="background-color:bisque; ">
                                    
                                </div>
                            </div>
                            
                        </div>
                    
                </div>
            </div>
        </div>
    </section>

    
    

    
   
  

    <script>
        var myArray = [];

        // 使用 fetch 從伺服器獲取 JSON 檔案
        fetch('./data/dashboard.json')
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
                // 將獲得的 JSON 數據存入 myArray
                myArray = data;
                // 調用 buildTable 函數來建立表格
                buildTable(myArray);
            })
            .catch(function (error) {
                console.error('Error fetching JSON: ', error);
            });

            function buildTable(data) {
    var table = document.getElementById('myTable');
    
    for (var key in data) {
        if (data.hasOwnProperty(key)) {
            var count_traceroute = data[key].traceroute[0].count;
            var count_webloading = data[key].webloading[0].count;
            var Dpload = data[key].Download[0].speed;
            var upload = data[key].Upload[0].speed;
            var row = `
                <tr >
                    
                    <td><div class="light" data-count-traceroute="${count_traceroute}" data-count-webloading="${count_webloading}"></div></td>
                    <td style="text-align: center;"><h2>${key}</h2></td>
                    
                    <td style="text-align: center;">${data[key].traceroute[0].exceed}%</td>
                    <td style="text-align: center;">${count_traceroute}</td>
                    <td style="text-align: center;">${data[key].webloading[0].exceed}%</td>
                    <td style="text-align: center;">${count_webloading}</td>
                    <td style="text-align: center;">${upload}</td>
                    <td style="text-align: center;">${Dpload}</td>
                    <td><a href="./traceroute.html?location=${encodeURIComponent(key)}&mode=traceroute">完整內容</a></td>
                </tr>`;
            table.innerHTML += row;
        }
    }
    
    var lights = document.querySelectorAll('.light');

    // 循环遍历每个元素，根据 COUNT 的值来更改颜色
    lights.forEach(function(light) {
        var count_traceroute = parseInt(light.getAttribute('data-count-traceroute'));
        var count_webloading = parseInt(light.getAttribute('data-count-webloading'));

        // 根据 COUNT 的值更改颜色
        if (count_traceroute < 5 && count_webloading < 10) {
            light.style.backgroundColor = 'green';
        } 
        else if (count_traceroute > 5 && count_webloading > 10) {
            light.style.backgroundColor = 'red';
        }
        else {
            light.style.backgroundColor = 'yellow';
        } 
    });
}


    </script>
    <script>
    // 在页面加载完成后执行
    window.onload = function () {
        fetchDataAndProcess('./data/dcard.json', 'dcard');
        fetchDataAndProcess('./data/internet_center.json', 'internet_center');
    };

    function fetchDataAndProcess(jsonFilePath, targetElementId) {
        fetch(jsonFilePath)
            .then(function (response) {
                return response.json();
            })
            .then(function (jsonData) {
                // 调用相应的处理函数
                switch (targetElementId) {
                    case 'dcard':
                        var firstEntry = jsonData[Object.keys(jsonData)[0]];
                
                        dcard(jsonData, targetElementId);
                        break;
                    case 'internet_center':
                        var firstEntry = jsonData[Object.keys(jsonData)[0]];
                        internet_center(firstEntry, targetElementId);
                        break;
                    default:
                        console.error('未知的目标元素 ID: ' + targetElementId);
                        break;
                }
            })
            .catch(function (error) {
                console.error('获取 JSON 时出错：', error);
            });
    }

    function dcard(data, targetElementId) {
    var dcardElement = document.getElementById(targetElementId);

    // 清空目标元素的内容
    dcardElement.innerHTML = '';

    // 检查数据是否存在
    if (data) {
        // 获取日期
        var date = Object.keys(data)[0];
        var title = data[date].title; // 获取 title
        var context = data[date].context; // 获取 context

        var row = `
            <p>Dcard</p>
            <div id="date">
                <p>${date}</p>
            </div>
            <div id="title">
                <p>${title}</p>
            </div>
            <div id="context">
                <span>
                    ${context}
                </span>
            </div>`;

        dcardElement.innerHTML += row;
    }
}

    function internet_center(data, targetElementId) {
        var internetCenterElement = document.getElementById(targetElementId);

        // 清空目标元素的内容
        internetCenterElement.innerHTML = '';

        // 检查数据是否存在
        if (data) {
            var time = data.time;
            var level = data.level;
            var id = data.id;

            var row = `
                <p>區網中心</p>
                <div id="time">
                    <p>${time}</p>
                </div>
                <div id="level">
                    <p>${level}</p>
                </div>
                <div id="id">
                    <span>
                        ${id}
                    </span>
                </div>`;

            internetCenterElement.innerHTML += row;
        }
    }


</script>
    


    

    
</body>

</html>